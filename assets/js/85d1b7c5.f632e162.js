"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[14995],{3905:(e,t,r)=>{r.d(t,{Zo:()=>l,kt:()=>d});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=n.createContext({}),p=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},l=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(r),m=a,d=u["".concat(c,".").concat(m)]||u[m]||h[m]||i;return r?n.createElement(d,o(o({ref:t},l),{},{components:r})):n.createElement(d,o({ref:t},l))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},22445:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=r(87462),a=(r(67294),r(3905));const i={id:"architectural-patterns",title:"Architectural Patterns"},o=void 0,s={unversionedId:"reference/architecture/architectural-patterns",id:"reference/architecture/architectural-patterns",title:"Architectural Patterns",description:"In this section, we are going to talk about the design elements of a ZIO application and the ZIO idiomatic way of structuring codes to write ZIO applications.",source:"@site/docs/reference/architecture/architectural-patterns.md",sourceDirName:"reference/architecture",slug:"/reference/architecture/architectural-patterns",permalink:"/reference/architecture/architectural-patterns",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/reference/architecture/architectural-patterns.md",tags:[],version:"current",frontMatter:{id:"architectural-patterns",title:"Architectural Patterns"},sidebar:"reference-sidebar",previous:{title:"Non-functional Requirements",permalink:"/reference/architecture/non-functional-requirements"},next:{title:"Functional Design Patterns",permalink:"/reference/architecture/functional-design-patterns"}},c={},p=[{value:"Onion Architecture",id:"onion-architecture",level:2},{value:"Streaming Architecture",id:"streaming-architecture",level:2},{value:"Sidecar Pattern",id:"sidecar-pattern",level:2},{value:"Composable ZIO Applications",id:"composable-zio-applications",level:3},{value:"Bootstrap Layer",id:"bootstrap-layer",level:3}],l={toc:p},u="wrapper";function h(e){let{components:t,...r}=e;return(0,a.kt)(u,(0,n.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In this section, we are going to talk about the design elements of a ZIO application and the ZIO idiomatic way of structuring codes to write ZIO applications."),(0,a.kt)("h2",{id:"onion-architecture"},"Onion Architecture"),(0,a.kt)("p",null,"Onion architecture is a software architecture pattern that is used to create loosely coupled, maintainable, and testable applications by layering the application into a set of concentric circles."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The innermost layer contains the domain model. Its language has the highest level of abstraction."),(0,a.kt)("li",{parentName:"ul"},"From the very center, the language domain model is surrounded successively by other layers, each of which is more technical and has a lower level of abstraction than the previous one."),(0,a.kt)("li",{parentName:"ul"},"The outermost layer contains the final language is the one that is closest to the environment in which the application is running. For example, the outermost layer could be the user interface, a web API, etc.")),(0,a.kt)("p",null,"Onion architecture is based on the ",(0,a.kt)("em",{parentName:"p"},"inversion of control")," principle. So each layer is dependent on the underlying layer, but not on the layers above it. This means that the innermost layer is independent of any other layers."),(0,a.kt)("p",null,"In ZIO by taking advantage of both functional and object-oriented programming, we can implement onion architecture in a very simple and elegant way. To implement this architecture, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"/reference/service-pattern/introduction"},"Writing ZIO Services")," section which empowers you to create layers (services) in the onion architecture. In order to assemble all layers and make the whole application work, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"/reference/di/"},"Dependency Injection In ZIO")," section."),(0,a.kt)("h2",{id:"streaming-architecture"},"Streaming Architecture"),(0,a.kt)("p",null,"Many reasons make streaming architecture a good choice for building applications:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"From the technical perspective when we are dealing with files, sockets, HTTP requests, databases, etc we are working with streams of data."),(0,a.kt)("li",{parentName:"ul"},"In addition from a business standpoint, the area of data processing is growing rapidly and the need for processing continuous streams of data is increasing, such as real-time analytics, fraud detection, monitoring, social media platforms, financial trading, etc.")),(0,a.kt)("p",null,"In such cases, we may decide to use streaming architecture. ZIO Streams is a library that provides a purely functional, composable, and type-safe way to work with streams of data. We can use ZIO Streams to model both stateful and stateless streaming data processing pipelines."),(0,a.kt)("p",null,"ZIO Streams is on top of ZIO. So we can think of ",(0,a.kt)("inlineCode",{parentName:"p"},"ZStream")," as a specialized functional effect that has more power than ",(0,a.kt)("inlineCode",{parentName:"p"},"ZIO"),". It is built on top of ZIO and supports backpressure using a pull-based model. To learn more about ZIO Streams, please refer to the ",(0,a.kt)("a",{parentName:"p",href:"/reference/stream/"},"ZIO Streams")," section."),(0,a.kt)("h2",{id:"sidecar-pattern"},"Sidecar Pattern"),(0,a.kt)("p",null,"The sidecar pattern is a microservice architecture pattern that is used to separate cross-cutting concerns from the main business logic. It is a very useful pattern when we have to deal with concerns like logging, metrics, profiling, monitoring, etc. These concerns are not part of the main service logic, but they are important for the service to work correctly."),(0,a.kt)("p",null,"In ZIO, we can implement the sidecar pattern by using compositional apps, or by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"bootstrap")," layer."),(0,a.kt)("h3",{id:"composable-zio-applications"},"Composable ZIO Applications"),(0,a.kt)("p",null,"In the following example, as we have multiple applications (",(0,a.kt)("inlineCode",{parentName:"p"},"UserApp")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"DocumentApp"),"), we use compositional apps to implement this pattern:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-scala"},'import zio._\nimport zhttp.http._\nimport zhttp.service.Server\nimport zio.metrics.connectors.prometheus.PrometheusPublisher\nimport zio.metrics.connectors.{MetricsConfig, prometheus}\n\nobject UserApp extends ZIOAppDefault {\n  def run = Server.start(port = 8080, http = userHttpApp)\n}\n\nobject DocumentApp extends ZIOAppDefault {\n  def run = Server.start(port = 8081, http = documentHttpApp)\n}\n\nobject Metrics extends ZIOAppDefault {\n  private val metricsConfig = ZLayer.succeed(MetricsConfig(5.seconds))\n\n  def run =\n    Server\n      .start(\n        port = 8082,\n        http = Http.collectZIO[Request] { case Method.GET -> !! / "metrics" =>\n          ZIO.serviceWithZIO[PrometheusPublisher](_.get.map(Response.text))\n        }\n      )\n      .provide(\n        metricsConfig,\n        prometheus.publisherLayer,\n        prometheus.prometheusLayer\n      )\n}\n\nobject MainApp extends ZIOApp.Proxy(UserApp <> DocumentApp <> Metrics)\n')),(0,a.kt)("h3",{id:"bootstrap-layer"},"Bootstrap Layer"),(0,a.kt)("p",null,"If we had only one application, we could use the ",(0,a.kt)("inlineCode",{parentName:"p"},"bootstrap")," layer to implement this pattern:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-scala"},'import zio._\nimport zhttp.http._\nimport zhttp.service.Server\nimport zio.metrics.connectors.prometheus.PrometheusPublisher\nimport zio.metrics.connectors.{MetricsConfig, prometheus}\n\nobject MetricsService {\n  private val metricsConfig = ZLayer.succeed(MetricsConfig(5.seconds))\n\n  private val exporter: ZLayer[PrometheusPublisher, Nothing, Unit] =\n    ZLayer.fromZIO {\n      Server\n        .start(\n          port = 8081,\n          http = Http.collectZIO[Request] { case Method.GET -> !! / "metrics" =>\n            ZIO.serviceWithZIO[PrometheusPublisher](_.get.map(Response.text))\n          }\n        )\n        .forkDaemon\n        .unit\n    }\n\n  val layer: ZLayer[Any, Nothing, Unit] =\n    ZLayer.make[Unit](\n      exporter,\n      metricsConfig,\n      prometheus.publisherLayer,\n      prometheus.prometheusLayer\n    )\n\n}\n\nobject UserAoo extends ZIOAppDefault {\n  override val bootstrap = MetricsService.layer\n\n  def run = Server.start(port = 8080, http = userHttpApp)\n}\n')))}h.isMDXComponent=!0}}]);