"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[84460],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(n),u=i,h=m["".concat(s,".").concat(u)]||m[u]||c[u]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},19917:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const r={id:"activities",title:"Activities"},o="Activities",l={unversionedId:"zio-flow/activities",id:"zio-flow/activities",title:"Activities",description:"Overview",source:"@site/docs/zio-flow/activities.md",sourceDirName:"zio-flow",slug:"/zio-flow/activities",permalink:"/zio-flow/activities",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/zio-flow/activities.md",tags:[],version:"current",frontMatter:{id:"activities",title:"Activities"},sidebar:"ecosystem-sidebar",previous:{title:"Remote",permalink:"/zio-flow/remote"},next:{title:"Execution",permalink:"/zio-flow/execution"}},s={},p=[{value:"Overview",id:"overview",level:2},{value:"Running activities in flows",id:"running-activities-in-flows",level:3},{value:"Transforming activities",id:"transforming-activities",level:3},{value:"HTTP",id:"http",level:2},{value:"Custom",id:"custom",level:2},{value:"Activity libraries",id:"activity-libraries",level:2},{value:"Twilio",id:"twilio",level:3},{value:"SendGrid",id:"sendgrid",level:3},{value:"Write your own",id:"write-your-own",level:3}],d={toc:p},m="wrapper";function c(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"activities"},"Activities"),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"Activities describe how to communicate with the external world from a ZIO Flow program, and they provide special support\nto be used from within ",(0,i.kt)("em",{parentName:"p"},"transactions"),". Let's see a real world example of defining an activity:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'import zio.flow._\nimport zio.flow.operation.http._\n\ntype CreateMessage = String // Real type not shown here\ntype Message = String // Real type not shown here\n\nval twilioAccountSid: ConfigKey = ConfigKey("authentication.twilio.account_sid")\nval twilioAuthToken: ConfigKey = ConfigKey("authentication.twilio.auth_token")\n\nprivate lazy val twilioAuthHeader: Remote[String] =\n  rs"Basic " + rs"${Remote.config[String](twilioAccountSid)}:${Remote.config[String](twilioAuthToken)}".toBase64\n\nlazy val sendSMS: Activity[CreateMessage, Message] =\n  Activity(\n    "twilio_sendSMS",\n    "Sends an SMS using a Twilio account",\n    operation = Operation.Http(\n      host = "https://api.twilio.com",\n      API\n        .post("2010-04-01" / "Accounts" / string / "Messages.json")\n        .header(Header.string("Authorization"))\n        .input[CreateMessage](ContentType.`x-www-form-urlencoded`)\n        .output[Message]\n    ),\n    check = Activity.checkNotSupported,\n    compensate = Activity.compensateNotSupported\n  ).contramap[CreateMessage] { (createMessage: Remote[CreateMessage]) =>\n    (\n      Remote.config[String](twilioAccountSid),\n      twilioAuthHeader,\n      createMessage\n    )\n  }\n')),(0,i.kt)("p",null,"This is a slightly simplified version of an ",(0,i.kt)("em",{parentName:"p"},"activity")," that uses Twilio as a third party provider for sending SMS.\nLet's go through this definition line by line!"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"First we need an ",(0,i.kt)("em",{parentName:"li"},"input type")," for our activity - in this case it is called ",(0,i.kt)("inlineCode",{parentName:"li"},"CreateMessage")," and in a real\nimplementation it would be a case class with many fields but for simplicity we just define it as a ",(0,i.kt)("inlineCode",{parentName:"li"},"String")," here."),(0,i.kt)("li",{parentName:"ul"},"When the activity succeeds it also returns a value - for this we define the type ",(0,i.kt)("inlineCode",{parentName:"li"},"Message"),", omitting the details for\nit as well, representing an SMS that has been sent."),(0,i.kt)("li",{parentName:"ul"},"The next two lines defines two ",(0,i.kt)("inlineCode",{parentName:"li"},"ConfigKey"),"s for the Twilio account SID and auth token. These are used to authenticate\nwith Twilio. For more information about accessing configuration from ZIO Flow programs\nsee ",(0,i.kt)("a",{parentName:"li",href:"remote#accessing-configuration"},"the remotes section"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"twilioAuthHeader")," uses the ",(0,i.kt)("em",{parentName:"li"},"remote string interpolator")," feature to define a remote value which represents the ",(0,i.kt)("em",{parentName:"li"},"HTTP\nbasic auth header")," to be sent to Twilio. It's the concatenation of the accound ID and the token converted to Base64."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"sendSMS")," value defines the activity itself. Every activity has an ",(0,i.kt)("em",{parentName:"li"},"input")," and an ",(0,i.kt)("em",{parentName:"li"},"output")," type."),(0,i.kt)("li",{parentName:"ul"},"The first parameter defines a unique name for the activity, seen in logs, etc."),(0,i.kt)("li",{parentName:"ul"},"The second parameter is a textual description of what the activity does; it is not used currently but later could\nappear in user interfaces built around ZIO Flow."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"operation")," parameter defines how to perform the activity. In this case we use the ",(0,i.kt)("inlineCode",{parentName:"li"},"API")," helper to define an\noperation that calls an ",(0,i.kt)("em",{parentName:"li"},"HTTP endpoint"),". This is imported from ",(0,i.kt)("inlineCode",{parentName:"li"},"zio.flow.operation.http"),". More information about how\nto define HTTP requests can be found in the ",(0,i.kt)("a",{parentName:"li",href:"activities#http"},"next section"),"."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"check")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"compensate")," parameters are set to default values indicating that this functionality is not supported.")),(0,i.kt)("p",null,"An activity like the one above can do some external work but in case it is used in a ",(0,i.kt)("a",{parentName:"p",href:"zflow#transactions"},(0,i.kt)("em",{parentName:"a"},"transaction")),"\nit is important to be ",(0,i.kt)("em",{parentName:"p"},"idempotent"),". The reason is that a transaction's body may run multiple times in case it detects\nsome conflicts in the used variables; Without defining the ",(0,i.kt)("inlineCode",{parentName:"p"},"check")," and/or ",(0,i.kt)("inlineCode",{parentName:"p"},"compensate")," parameters of the activity ZIO\nFlow has no way to undo an activity like this - in the above example, the SMS will be sent as many times as the\ntransaction retries, and nothing will happen with sent SMS in case the transaction fails."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"check")," parameter can be set to a ",(0,i.kt)("inlineCode",{parentName:"p"},"ZFlow")," that checks if the activity has already been performed. If it has, it\nreturns the activity's expected output, and the ",(0,i.kt)("em",{parentName:"p"},"operation")," will not be performed. This is useful when a ZIO Flow\nprogram was restarted possibly due to a hardware failure or deployment, while it was in the middle of performing an\n",(0,i.kt)("em",{parentName:"p"},"activity"),". In this case the persisted state may indicate that the activity has not been performed yet, but maybe it was\nalready initiated; if there is no ",(0,i.kt)("inlineCode",{parentName:"p"},"check")," flow, the operation will be performed again - if we can ",(0,i.kt)("inlineCode",{parentName:"p"},"check")," if it has been\nperformed or not, duplicate call can be avoided."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"compensate")," parameter is also a ",(0,i.kt)("inlineCode",{parentName:"p"},"ZFlow"),', but it\'s purpose is to do something that "reverts" the performed activity.\nIt is called in case the transaction that invoked the activity has been rolled back, either for be retried, or because\nof a failure. In the above example if we assume that ',(0,i.kt)("inlineCode",{parentName:"p"},"sendSMS")," does not immediately send the message just schedules it\non the Twilio side, we may write a ",(0,i.kt)("inlineCode",{parentName:"p"},"compensate")," flow that calls a different Twilio API to cancel the scheduled message."),(0,i.kt)("h3",{id:"running-activities-in-flows"},"Running activities in flows"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Activity")," type defines two ways to run the activity:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the ",(0,i.kt)("inlineCode",{parentName:"li"},"apply")," method gets the activity's parameters as a parameter; using the activity like this is very similar to\ncalling a function"),(0,i.kt)("li",{parentName:"ul"},"the ",(0,i.kt)("inlineCode",{parentName:"li"},"fromInput")," method gets the activity's paramters from ",(0,i.kt)("inlineCode",{parentName:"li"},"ZFlow"),"s input")),(0,i.kt)("h3",{id:"transforming-activities"},"Transforming activities"),(0,i.kt)("p",null,"The activity allows to call ",(0,i.kt)("inlineCode",{parentName:"p"},"contramap")," on it and provide a function that transforms the activity's input before the\nactivity gets called. One very important use case for this is passing configuration values automatically to an\nactivity's operation."),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"sendSMS")," example above we define the operation using the HTTP DSL (described below), and that particular\noperation has the input type ",(0,i.kt)("inlineCode",{parentName:"p"},"(String, String, CreateMessage)"),'. The first string is the "hole" in the path, the second\nis the auth header, and the third one is the request body. We can hide the authentication from the activity\'s user by\nusing ',(0,i.kt)("inlineCode",{parentName:"p"},"contramap")," and passing ",(0,i.kt)("inlineCode",{parentName:"p"},"Remote.config")," values in place of the first two element of the operation's input, leaving\nonly the ",(0,i.kt)("inlineCode",{parentName:"p"},"CreateMessage")," body to be sent as a parameter to the activity."),(0,i.kt)("p",null,"Similarly the activity's output can be transformed with ",(0,i.kt)("inlineCode",{parentName:"p"},"mapResult")," if needed."),(0,i.kt)("h2",{id:"http"},"HTTP"),(0,i.kt)("p",null,"The only built-in ",(0,i.kt)("em",{parentName:"p"},"operation type")," supported by ZIO Flow at the moment is the ",(0,i.kt)("inlineCode",{parentName:"p"},"HTTP")," operation. A HTTP operation\ndescribes a call to a HTTP API, and it can be built using a ",(0,i.kt)("em",{parentName:"p"},"DSL")," that is accessible through the ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," object in\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"zio.flow.operation.http")," package."),(0,i.kt)("p",null,"Each method on the ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," object adds some information about how the HTTP request should be composed or how its response\nshould be interpreted. Some of these methods append additional input or output types to the operation's type signature."),(0,i.kt)("p",null,"For example if we define an operation that requires a ",(0,i.kt)("inlineCode",{parentName:"p"},"String")," as part of the request's path, and an integer to be sent\nin the body, and expect a list of strings to be parsed from the response body:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'val api1 = API.get("something" / string).input[Int].output[List[String]]\n')),(0,i.kt)("p",null,"we get a value with the type ",(0,i.kt)("inlineCode",{parentName:"p"},"API[(String, Int), Unit]"),"."),(0,i.kt)("p",null,"This can be wrapped in an ",(0,i.kt)("inlineCode",{parentName:"p"},"Operation.Http")," to create an ",(0,i.kt)("inlineCode",{parentName:"p"},"Operation")," that can be used in an ",(0,i.kt)("inlineCode",{parentName:"p"},"Activity"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'val op1 = Operation.Http(host = "https://example.com", api1)\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"op1")," value has the type ",(0,i.kt)("inlineCode",{parentName:"p"},"Operation.Http[(String, Int), List[String]]"),"."),(0,i.kt)("p",null,"The following table lists all the methods available on the ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," object to start defining a HTTP call:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Method"),(0,i.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"get")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Path")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines a ",(0,i.kt)("inlineCode",{parentName:"td"},"GET")," request.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"post")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Path")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines a ",(0,i.kt)("inlineCode",{parentName:"td"},"POST")," request.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"put")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Path")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines a ",(0,i.kt)("inlineCode",{parentName:"td"},"PUT")," request.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"delete")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Path")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines a ",(0,i.kt)("inlineCode",{parentName:"td"},"DELETE")," request.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"patch")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Path")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines a ",(0,i.kt)("inlineCode",{parentName:"td"},"PATCH")," request.")))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Path")," parameter passed to these represent the ",(0,i.kt)("em",{parentName:"p"},"path")," part of the URL of the request."),(0,i.kt)("p",null,"A ",(0,i.kt)("inlineCode",{parentName:"p"},"Path")," is constructed from multiple segments. Each segment is either a static string or a value received as the\noperation's input. The segments can be concatenated by either the ",(0,i.kt)("inlineCode",{parentName:"p"},"/")," operator, or the ",(0,i.kt)("inlineCode",{parentName:"p"},"+")," operator. The input-dependent\npath segments can have various types, and ZIO Flow defines a couple of helper methods to express them in a nice readable\nway. For example the following path expression defines a path that contains dynamic integer and UUID parts:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'val path1 = Path.path("api") / "v1" / "users" / int / "artifact" / uuid\n')),(0,i.kt)("p",null,"This has the type ",(0,i.kt)("inlineCode",{parentName:"p"},"Path[(Int, java.util.UUID)]"),"."),(0,i.kt)("p",null,"Note that we had to explicitly wrap the first string segment with ",(0,i.kt)("inlineCode",{parentName:"p"},"Path.path"),". This is usually not necessary when using\nthe path DSL because in that case the compiler already expects a ",(0,i.kt)("inlineCode",{parentName:"p"},"Path")," type and implicitly converts the string to\na ",(0,i.kt)("inlineCode",{parentName:"p"},"Path"),"."),(0,i.kt)("p",null,"The result of these is an ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," value that exposes further methods to customize the call:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Method"),(0,i.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"header")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Header")),(0,i.kt)("td",{parentName:"tr",align:null},"Adds a header to the request.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"input")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ContentType"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"Schema")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines the type of the request body, to be sent as JSON")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"output")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Schema")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines the type of the response body, to be parsed as JSON")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"query")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Query")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines query parameters to be added")))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Header")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," DSLs are similar to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Path")," in that they extend the operation's input types with new\nelements."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},'Header.string("X-Custom-Header")')," defines a custom header to be sent in the request, and it adds a ",(0,i.kt)("inlineCode",{parentName:"p"},"String")," input\nto the operation. To send more than one headers, the ",(0,i.kt)("inlineCode",{parentName:"p"},"++")," operator can be used to create a sequence of them."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," builder is very similar, but just like for ",(0,i.kt)("inlineCode",{parentName:"p"},"Path"),"s, we have a couple of predefined builders for common\ntypes. For both ",(0,i.kt)("inlineCode",{parentName:"p"},"Header")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," there is a ",(0,i.kt)("inlineCode",{parentName:"p"},"?")," operator defined on these types, converting the given header or\nquery parameter to optional. That changes its type in the ",(0,i.kt)("em",{parentName:"p"},"input type")," to an ",(0,i.kt)("inlineCode",{parentName:"p"},"Option[A]"),"."),(0,i.kt)("p",null,"An example for defining query parameters could be:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'val query1 = long("timestamp") ++ string("description").? ++ uuid("id")\n')),(0,i.kt)("p",null,"which has the type ",(0,i.kt)("inlineCode",{parentName:"p"},"Query[(Long, Option[String], java.util.UUID)]"),"."),(0,i.kt)("h2",{id:"custom"},"Custom"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Operation"),"s are one of the extension points of ZIO Flow. For custom operations you need to use ",(0,i.kt)("inlineCode",{parentName:"p"},"Operaiton.Custom"),", and\nalso need to install a custom ",(0,i.kt)("em",{parentName:"p"},"operation executor")," on the server that executes the ZIO Flow programs. This is described\nin the ",(0,i.kt)("a",{parentName:"p",href:"execution#custom-operation-executor"},"execution section"),"."),(0,i.kt)("h2",{id:"activity-libraries"},"Activity libraries"),(0,i.kt)("p",null,"ZIO Flow defines some predefined set of activities in ",(0,i.kt)("em",{parentName:"p"},"activity libraries"),". These are separate artifacts published for\nboth the JVM and Scala.JS, ",(0,i.kt)("inlineCode",{parentName:"p"},"Activity")," definitions and corresponding data types with schema."),(0,i.kt)("p",null,"We have the following activity libraries at the moment:"),(0,i.kt)("h3",{id:"twilio"},"Twilio"),(0,i.kt)("p",null,"To use the ",(0,i.kt)("a",{parentName:"p",href:"https://www.twilio.com/"},"Twilio")," activity library, add the following dependency to your project:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "dev.zio" %% "zio-flow-twilio" % "1.0.0-RC4"\n')),(0,i.kt)("p",null,"This library defines the following activities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sendSMS")," - sends an SMS to a phone number of registered target, either immediately or scheduled"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"deleteMessageActivity")," - deletes a message from the Twilio account; if it is a scheduled message, this will prevent\nit from being sent")),(0,i.kt)("p",null,"The library defines a case class called ",(0,i.kt)("inlineCode",{parentName:"p"},"CreateMessage")," that describes the message to be sent, and ",(0,i.kt)("inlineCode",{parentName:"p"},"Message")," represents\nan SMS registered in the system."),(0,i.kt)("p",null,"The following example parameter for the ",(0,i.kt)("inlineCode",{parentName:"p"},"sendSMS")," activity defines a scheduled SMS to be sent to a phone number:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'import zio.flow._\nimport zio.flow.activities.twilio._\nimport java.time.Instant\n\nCreateMessage(\n  To = PhoneNumber("+15558675310"),\n  MessagingServiceSid = Some(MessagingServiceSid("MGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")),\n  Body = "This is a scheduled message",\n  SendAt = Some(Instant.parse("2021-11-30T20:36:27Z")),\n  StatusCallback = Some(CallbackUrl("https://webhook.site/xxxxx")),\n  ScheduleType = Some(MessageScheduleType.fixed)\n)\n')),(0,i.kt)("p",null,"To use these activities, you need to provide\nyour ",(0,i.kt)("a",{parentName:"p",href:"https://www.twilio.com/docs/iam/api/authtoken"},"Twilio account SID and auth token")," under the following\nconfiguration keys:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"authentication.twilio.account_sid")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"authentication.twilio.auth_token"))),(0,i.kt)("h3",{id:"sendgrid"},"SendGrid"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://sendgrid.com/"},"SendGrid")," activity library is available under the following dependency:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "dev.zio" %% "zio-flow-sendgrid" % "1.0.0-RC4"\n')),(0,i.kt)("p",null,"It currently defines a single activity called ",(0,i.kt)("inlineCode",{parentName:"p"},"sendMail"),".\nTo use this activity, you need to create\na ",(0,i.kt)("a",{parentName:"p",href:"https://docs.sendgrid.com/ui/account-and-settings/api-keys"},"SendGrid API key")," and set it under the following\nconfiguration key:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"authentication.sendgrid.api_key"))),(0,i.kt)("p",null,"The following code snippet shows an example of using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Mail")," data structure to send an email via SendGrid:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'import zio.flow.activities.sendgrid._\n\nval exampleMail: Mail =\n  Mail(\n    personalizations = List(\n      Personalization(\n        to = List(\n          EmailAddress(email = "john_doe@example.com", name = "John Doe"),\n          EmailAddress(email = "julia_doe@example.com", name = "Julia Doe")\n        ),\n        cc = Some(\n          List(\n            EmailAddress(email = "jane_doe@example.com", name = "Jane Doe")\n          )\n        ),\n        bcc = Some(\n          List(\n            EmailAddress(email = "james_doe@example.com", name = "Jim Doe")\n          )\n        )\n      ),\n      Personalization(\n        from = Some(\n          EmailAddress(\n            email = "sales@example.com",\n            name = "Example Sales Team"\n          )\n        ),\n        to = List(\n          EmailAddress(email = "janice_doe@example.com", name = "Janice Doe")\n        ),\n        bcc = Some(\n          List(\n            EmailAddress(email = "jordan_doe@example.com", name = "Jordan Doe")\n          )\n        )\n      )\n    ),\n    from = EmailAddress(email = "orders@example.com", name = "Example Order Confirmation"),\n    reply_to = Some(EmailAddress(email = "customer_service@example.com", name = "Example Customer Service Team")),\n    subject = "Your Example Order Confirmation",\n    content = List(\n      Content(\n        `type` = "text/html",\n        value =\n          "<p>Hello from Twilio SendGrid!</p><p>Sending with the email service trusted by developers and marketers for <strong>time-savings</strong>, <strong>scalability</strong>, and <strong>delivery expertise</strong>.</p><p>%open-track%</p>"\n      )\n    ),\n    attachments = Some(\n      List(\n        Attachment(\n          content =\n            "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICAgICAgPG1ldGEgaHR0cC1lcXVpdj0iWC1VQS1Db21wYXRpYmxlIiBjb250ZW50PSJJRT1lZGdlIj4KICAgICAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICAgICAgPHRpdGxlPkRvY3VtZW50PC90aXRsZT4KICAgIDwvaGVhZD4KCiAgICA8Ym9keT4KCiAgICA8L2JvZHk+Cgo8L2h0bWw+Cg==",\n          filename = "index.html",\n          `type` = "text/html",\n          disposition = "attachment"\n        )\n      )\n    ),\n    categories = Some(List(CategoryName("cake"), CategoryName("pie"), CategoryName("baking"))),\n    send_at = Some(1617260400),\n    batch_id = Some(BatchId("AsdFgHjklQweRTYuIopzXcVBNm0aSDfGHjklmZcVbNMqWert1znmOP2asDFjkl")),\n    asm = Some(\n      Asm(\n        group_id = 12345,\n        groups_to_display = List(12345)\n      )\n    ),\n    ip_pool_name = Some("transactional email"),\n    mail_settings = Some(\n      MailSettings(\n        bypass_list_management = Some(Setting(enable = false)),\n        footer = Some(Footer(enable = false)),\n        sandbox_mode = Some(Setting(enable = false))\n      )\n    ),\n    tracking_settings = Some(\n      TrackingSettings(\n        click_tracking = Some(\n          ClickTracking(\n            enable = true,\n            enable_text = false\n          )\n        ),\n        open_tracking = Some(\n          OpenTracking(\n            enable = true,\n            substitution_tag = Some("%open-track%")\n          )\n        ),\n        subscription_tracking = Some(SubscriptionTracking(enable = false))\n      )\n    )\n  )\n')),(0,i.kt)("h3",{id:"write-your-own"},"Write your own"),(0,i.kt)("p",null,"It is recommended to write reusable activities for your own use cases, and package them to similar activity libraries.\nBoth the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/zio/zio-flow/tree/main/activities/zio-flow-twilio/"},"twilio")," and\nthe ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/zio/zio-flow/tree/main/activities/zio-flow-sendgrid/"},"sendgrid")," libraries are good examples of\nhow to do this."))}c.isMDXComponent=!0}}]);